<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LearnToShame.ViewModels"
             xmlns:model="clr-namespace:LearnToShame.Models"
             xmlns:helpers="clr-namespace:LearnToShame.Helpers"
             x:DataType="vm:RoadmapViewModel"
             x:Class="LearnToShame.Views.RoadmapPage"
             Title="Roadmap">

    <ScrollView>
        <VerticalStackLayout Padding="32" Spacing="24">
            <Frame BackgroundColor="{StaticResource Primary}" Padding="24" CornerRadius="14">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Current Level" TextColor="White" FontSize="22"/>
                    <Label Text="{Binding CurrentLevelName}" TextColor="White" FontSize="36" FontAttributes="Bold"/>
                    <ProgressBar Progress="{Binding ProgressValue}" ProgressColor="{StaticResource Secondary}" HeightRequest="12" Margin="0,16,0,0"/>
                </VerticalStackLayout>
            </Frame>
            
            <Label Text="Tasks" FontSize="28" FontAttributes="Bold" Margin="0,16"/>

            <Label Text="Show per page:" FontSize="18" Margin="0,0,0,8"/>
            <HorizontalStackLayout Spacing="12" Margin="0,0,0,16">
                <Button Text="10" Command="{Binding SetPageSizeCommand}" CommandParameter="10"
                        Padding="20,12" MinimumWidthRequest="64" MinimumHeightRequest="48">
                    <Button.Behaviors>
                        <helpers:ButtonPressAnimationBehavior />
                    </Button.Behaviors>
                </Button>
                <Button Text="25" Command="{Binding SetPageSizeCommand}" CommandParameter="25"
                        Padding="20,12" MinimumWidthRequest="64" MinimumHeightRequest="48">
                    <Button.Behaviors>
                        <helpers:ButtonPressAnimationBehavior />
                    </Button.Behaviors>
                </Button>
                <Button Text="50" Command="{Binding SetPageSizeCommand}" CommandParameter="50"
                        Padding="20,12" MinimumWidthRequest="64" MinimumHeightRequest="48">
                    <Button.Behaviors>
                        <helpers:ButtonPressAnimationBehavior />
                    </Button.Behaviors>
                </Button>
            </HorizontalStackLayout>
            
            <VerticalStackLayout BindableLayout.ItemsSource="{Binding TasksOnCurrentPage}">
                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="model:RoadmapTask">
                        <Frame Margin="0,8" Padding="20" CornerRadius="14">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RoadmapViewModel}}, Path=ToggleTaskCommand}" CommandParameter="{Binding .}"/>
                            </Frame.GestureRecognizers>
                            <Grid ColumnDefinitions="*, Auto">
                                <VerticalStackLayout Grid.Column="0" Spacing="4">
                                    <Label Text="{Binding Title}" FontAttributes="Bold" FontSize="22"/>
                                    <Label Text="{Binding Description}" FontSize="18" TextColor="Gray"/>
                                    <Label Text="{Binding PointsReward, StringFormat='Reward: {0} pts'}" FontSize="17" TextColor="{StaticResource Primary}"/>
                                </VerticalStackLayout>
                                <CheckBox Grid.Column="1" IsChecked="{Binding IsCompleted}" IsEnabled="False" Scale="1.4"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </VerticalStackLayout>

            <Grid ColumnDefinitions="*, Auto, *" Margin="0,20,0,0" ColumnSpacing="12">
                <Button Grid.Column="0" Text="← Back" Command="{Binding PreviousPageCommand}"
                        IsEnabled="{Binding CanGoPrev}" HorizontalOptions="Fill"
                        Padding="16,12" MinimumHeightRequest="48" MinimumWidthRequest="110" FontSize="16">
                    <Button.Behaviors>
                        <helpers:ButtonPressAnimationBehavior />
                    </Button.Behaviors>
                </Button>
                <Label Grid.Column="1" VerticalOptions="Center" Text="{Binding PageInfo}" FontSize="18"/>
                <Button Grid.Column="2" Text="Forward →" Command="{Binding NextPageCommand}"
                        IsEnabled="{Binding CanGoNext}" HorizontalOptions="Fill"
                        Padding="16,12" MinimumHeightRequest="48" MinimumWidthRequest="110" FontSize="16">
                    <Button.Behaviors>
                        <helpers:ButtonPressAnimationBehavior />
                    </Button.Behaviors>
                </Button>
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
