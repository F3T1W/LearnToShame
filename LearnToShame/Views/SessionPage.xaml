<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LearnToShame.ViewModels"
             xmlns:helpers="clr-namespace:LearnToShame.Helpers"
             xmlns:views="clr-namespace:LearnToShame.Views"
             x:DataType="vm:SessionViewModel"
             x:Class="LearnToShame.Views.SessionPage"
             Title="{Binding Source={StaticResource L}, Path=TrainingSession}"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto, *, Auto">
        <VerticalStackLayout Grid.Row="0" Padding="20" BackgroundColor="Black">
            <Label Text="{Binding TimerText}" TextColor="Red" FontSize="48" HorizontalOptions="Center" FontAttributes="Bold"/>
        </VerticalStackLayout>
        
        <Grid Grid.Row="1" RowDefinitions="*, Auto" ColumnDefinitions="Auto, *, Auto" BackgroundColor="Black" Padding="8">
            <Button Grid.Row="0" Grid.Column="0" Text="‹" Command="{Binding PrevImageCommand}" IsVisible="{Binding HasMultipleImages}"
                    BackgroundColor="Transparent" TextColor="White" FontSize="48" WidthRequest="56" VerticalOptions="Center"/>
            <Grid Grid.Row="0" Grid.Column="1" BackgroundColor="Black">
                <Image Source="{Binding CurrentImage}" Aspect="AspectFit" BackgroundColor="Black">
                    <Image.GestureRecognizers>
                        <SwipeGestureRecognizer Direction="Right" Command="{Binding PrevImageCommand}"/>
                        <SwipeGestureRecognizer Direction="Left" Command="{Binding NextImageCommand}"/>
                    </Image.GestureRecognizers>
                </Image>
                <views:KeyCaptureView PrevCommand="{Binding PrevImageCommand}" NextCommand="{Binding NextImageCommand}"
                                     HorizontalOptions="Fill" VerticalOptions="Fill" InputTransparent="True"/>
            </Grid>
            <Button Grid.Row="0" Grid.Column="2" Text="›" Command="{Binding NextImageCommand}" IsVisible="{Binding HasMultipleImages}"
                    BackgroundColor="Transparent" TextColor="White" FontSize="48" WidthRequest="56" VerticalOptions="Center"/>
            <Label Grid.Row="1" Grid.ColumnSpan="3" Text="‹ ›  или  A/D (EN) / ф/в (RU)  или свайп" IsVisible="{Binding HasMultipleImages}"
                   TextColor="#88ffffff" FontSize="12" HorizontalOptions="Center" Margin="0,8,0,0"/>
        </Grid>
        
        <ActivityIndicator Grid.Row="1" IsRunning="{Binding IsLoading}" IsVisible="{Binding IsLoading}" Color="{StaticResource Primary}" HorizontalOptions="Center" VerticalOptions="Center" WidthRequest="80" HeightRequest="80"/>
        
        <Button Grid.Row="2" Text="{Binding Source={StaticResource L}, Path=Finish}" Command="{Binding FinishSessionCommand}" 
                BackgroundColor="Red" TextColor="White" HeightRequest="96" FontAttributes="Bold" FontSize="32" CornerRadius="14" Margin="32" Padding="32,18">
            <Button.Behaviors>
                <helpers:ButtonPressAnimationBehavior />
            </Button.Behaviors>
        </Button>
    </Grid>

</ContentPage>
